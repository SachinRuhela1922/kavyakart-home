<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cart Detail</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/remixicon/4.6.0/remixicon.min.css" />
</head>
<body class="bg-gray-100 font-sans">
      <header
      class="fixed top-0 left-0 bg-blue-500 right-0 bg-primary z-50 h-20 will-change-transform"
      style="backface-visibility: hidden; transform-style: preserve-3d"
    >
      <div class="flex items-center justify-between px-4 h-full">
        <!-- Logo with Text -->
        <!-- Logo with Text -->
        <div class="flex items-center space-x-2 w-auto  cursor-pointer" onclick="window.location.href='index.html'">
  <img class="w-10 h-10 object-contain" src="./image/logo.png" alt="KavyaKart Logo">
  <h6 class="text-white text-xs sm:text-sm font-['Dancing_Script'] leading-tight">KavyaKart</h6>
</div>

        <!-- Search Box -->
        <div class="hidden md:block flex-1 max-w-lg mx-4">
          <div class="relative">
            <input
              type="text"
              placeholder="Search..."
              class="w-full px-4 py-2 pr-12 rounded text-sm border-none outline-none"
              id="searchInput"
            />
            <button
              class="absolute right-0 top-0 h-full px-4 bg-orange-400 rounded-r hover:bg-orange-500"
            >
              <i class="ri-search-line text-white"></i>
            </button>
          </div>
        </div>

        <!-- Desktop Menu -->
        <div class="hidden md:flex items-center space-x-6 text-white">
          <button
            id="accountBtn"
            class="flex items-center space-x-1 hover:text-gray-200"
            onclick="window.location.href='account.html'"
          >
            <i class="ri-user-line"></i>
            <span class="text-sm">Account</span>
          </button>
          <button
            id="accountBtn"
            class="flex items-center space-x-1 hover:text-gray-200"
            onclick="window.location.href='order.html'"
          >
            <i class="ri-user-line"></i>
            <span class="text-sm">Order</span>
          </button>

          <button
            class="flex items-center space-x-1 hover:text-gray-200 relative"
            onclick="window.location.href='cart.html'"
          >
            <i class="ri-shopping-cart-line"></i>
            <span class="text-sm">Cart</span>
            <span
              class="absolute -top-2 -right-2 bg-orange-500 text-xs rounded-full w-5 h-5 flex items-center justify-center"
              >3</span
            >
          </button>
        </div>

        <!-- Mobile Menu Icon -->
        <div class="md:hidden">
          <button id="menuToggle" class="text-white text-2xl">
            <i class="ri-menu-line"></i>
          </button>
        </div>
      </div>

      <!-- Mobile Dropdown Menu -->
      <div
        id="mobileMenu"
        class="md:hidden hidden bg-white text-black shadow-lg p-4 absolute top-16 right-4 w-48 rounded z-50"
      >
        <a href="account.html" class="block py-2 hover:text-primary border-b">Account</a>
        <a href="cart.html" class="block py-2 hover:text-primary border-b">Cart</a>
        <a href="order.html" class="block py-2 hover:text-primary">Orders</a>
      </div>
    </header>

  <div class="max-w-3xl mx-auto mt-24 px-4 py-6">
    <h1 class="text-3xl font-bold text-center mb-6 text-blue-500">üõçÔ∏è Order Placed Here</h1>

    <!-- Product Detail -->
    <div id="productDetail" class="bg-white p-6 rounded-xl shadow-md mb-6"></div>

    <!-- Payment Method -->
    <div class="bg-white p-6 rounded-xl shadow-md mb-6">
      <h2 class="text-xl font-semibold text-gray-700 mb-4">üí≥ Payment Method</h2>
      <div class="flex flex-col gap-3">
        <label class="flex items-center gap-2 text-gray-600">
          <input type="radio" name="paymentMode" value="cod" checked />
          Cash on Delivery
        </label>
        <label class="flex items-center gap-2 text-gray-600">
          <input type="radio" name="paymentMode" value="online" />
          Online Payment
        </label>
      </div>

      <div id="onlinePaymentDetails" class="hidden mt-4 space-y-3">
        <img src="/image/qr.jpg" alt="QR Code" class="w-48 mx-auto border rounded" />
        <label class="block text-sm font-medium text-gray-700">Upload Payment Screenshot:</label>
        <input type="file" id="ssUpload" accept="image/*" class="block w-full text-sm text-gray-700"/>
      </div>
    </div>

    <!-- Place Order Button -->
    <div class="text-center">
      <button id="openAddressModal" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-green-700 focus:ring-4 focus:ring-green-300 flex items-center gap-2 justify-center mx-auto">
        <span>Place Order</span>
      </button>
    </div>
  </div>

  <!-- Address Modal -->
 <div id="addressModal" class="fixed top-0 left-0 w-screen h-screen bg-black bg-opacity-50 backdrop-blur-sm flex items-center justify-center z-50 hidden">
  <div class="bg-white p-6 rounded-xl shadow-lg w-full h-full md:w-[100%] md:h-[100%] overflow-y-auto rounded-none md:rounded-xl relative">
    
    <h2 class="text-2xl font-semibold text-gray-800 mb-4">üì¶ Shipping Address</h2>
    <button id="closeModal" class="absolute top-3 right-3 text-gray-500 hover:text-red-500 text-4xl font-bold">&times;</button>
    
    <div class="space-y-4">
      <input type="text" placeholder="Full Name" class="w-full h-12 border px-4 rounded-lg address" />
      <input type="text" placeholder="Phone Number" class="w-full h-12 border px-4 rounded-lg address" />
      <input type="text" placeholder="Street Address" class="w-full h-12 border px-4 rounded-lg address" />
      <input type="text" placeholder="City" class="w-full h-12 border px-4 rounded-lg address" />
      <input type="text" placeholder="State" class="w-full h-12 border px-4 rounded-lg address" />
      <input type="text" placeholder="Postal Code" class="w-full h-12 border px-4 rounded-lg address" />
      <input type="text" placeholder="Country" class="w-full h-12 border px-4 rounded-lg address" />
    </div>

    <button id="placeOrder" class="w-full mt-6 bg-green-600 text-white py-3 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2 text-lg">
      <span id="placeOrderText">Confirm Order</span>
      <svg id="loaderIcon" class="w-5 h-5 animate-spin hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v8z"></path>
      </svg>
    </button>
    
  </div>
</div>


      <footer class="bg-gray-900 text-white py-12 px-4">
      <div class="max-w-7xl mx-auto">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
          <div>
            <div class="text-white font-['Pacifico'] text-xl mb-4">
              <img class="w-16" src="./image/logo.png" alt="" />
            </div>
            <p class="text-gray-400 mb-4">
              Premium audio solutions for every lifestyle. Experience the future
              of sound with our innovative products.
            </p>
            <div class="flex space-x-4">
              <div
                class="w-8 h-8 bg-gray-800 rounded-full flex items-center justify-center hover:bg-gray-700 cursor-pointer"
              >
                <i class="ri-facebook-fill"></i>
              </div>
              <div
                class="w-8 h-8 bg-gray-800 rounded-full flex items-center justify-center hover:bg-gray-700 cursor-pointer"
              >
                <i class="ri-twitter-fill"></i>
              </div>
              <div
                class="w-8 h-8 bg-gray-800 rounded-full flex items-center justify-center hover:bg-gray-700 cursor-pointer"
              >
                <i class="ri-instagram-fill"></i>
              </div>
            </div>
          </div>

          <div>
            <h3 class="font-semibold mb-4">Products</h3>
            <ul class="space-y-2 text-gray-400">
              <li>
                <a href="#" class="hover:text-white transition-colors"
                  >Neckbands</a
                >
              </li>
              <li>
                <a href="#" class="hover:text-white transition-colors"
                  >Wireless Earbuds</a
                >
              </li>
              <li>
                <a href="#" class="hover:text-white transition-colors"
                  >Sports Earphones</a
                >
              </li>
              <li>
                <a href="#" class="hover:text-white transition-colors"
                  >Gaming Headsets</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h3 class="font-semibold mb-4">Support</h3>
            <ul class="space-y-2 text-gray-400">
              <li>
                <a href="#" class="hover:text-white transition-colors"
                  >Help Center</a
                >
              </li>
              <li>
                <a href="#" class="hover:text-white transition-colors"
                  >Warranty</a
                >
              </li>
              <li>
                <a href="#" class="hover:text-white transition-colors"
                  >Returns</a
                >
              </li>
              <li>
                <a href="#" class="hover:text-white transition-colors"
                  >Contact Us</a
                >
              </li>
            </ul>
          </div>

          <div>
            <h3 class="font-semibold mb-4">Newsletter</h3>
            <p class="text-gray-400 mb-4">
              Subscribe to get updates on new products and exclusive offers.
            </p>
            <div class="flex">
              <input
                type="email"
                placeholder="Enter your email"
                class="flex-1 px-3 py-2 bg-gray-800 border border-gray-700 rounded-l text-sm outline-none focus:border-primary"
              />
              <button
                class="px-4 py-2 bg-primary text-white rounded-r hover:bg-blue-700 transition-colors !rounded-button whitespace-nowrap"
              >
                Subscribe
              </button>
            </div>
          </div>
        </div>

        <div
          class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-400"
        >
          <p>&copy; 2025 KavyaKart. All rights reserved.</p>
        </div>
      </div>
    </footer>


<script>

  const menuBtn = document.getElementById("menuToggle");
      const mobileMenu = document.getElementById("mobileMenu");

      menuBtn.addEventListener("click", () => {
        mobileMenu.classList.toggle("hidden");
      });
// Load product
const product = JSON.parse(localStorage.getItem("cart-detail-product"));
const uid = localStorage.getItem("uid");
const productDetail = document.getElementById("productDetail");

if (!product) {
  productDetail.innerHTML = "<p class='text-red-500'>No product selected.</p>";
} else {
  productDetail.innerHTML = `
    <div class="flex gap-4 items-center">
      <img src="${product.image}" alt="${product.title}" class="w-32 h-32 object-cover rounded-md border" />
      <div>
        <h2 class="text-xl font-semibold text-gray-800">${product.title}</h2>
        <p class="text-gray-500 mt-1">Price: ‚Çπ${product.price}</p>
      </div>
    </div>
  `;
}

// Toggle payment detail
document.querySelectorAll("input[name='paymentMode']").forEach(radio => {
  radio.addEventListener("change", (e) => {
    document.getElementById("onlinePaymentDetails").classList.toggle("hidden", e.target.value !== "online");
  });
});

// Modal controls
document.getElementById("openAddressModal").onclick = () => {
  document.getElementById("addressModal").classList.remove("hidden");
};

document.getElementById("closeModal").onclick = () => {
  document.getElementById("addressModal").classList.add("hidden");
};

// Place order
document.getElementById("placeOrder").onclick = async () => {
  const inputs = document.querySelectorAll(".address");
  const address = {
    name: inputs[0].value,
    phone: inputs[1].value,
    street: inputs[2].value,
    city: inputs[3].value,
    state: inputs[4].value,
    postalCode: inputs[5].value,
    country: inputs[6].value,
  };

  const paymentMode = document.querySelector("input[name='paymentMode']:checked").value;
  const fileInput = document.getElementById("ssUpload");
  let screenshot = "";

  if (paymentMode === "online" && fileInput.files[0]) {
    const reader = new FileReader();
    reader.onload = async (e) => {
      screenshot = e.target.result;
      await submitOrder(address, paymentMode, screenshot);
    };
    reader.readAsDataURL(fileInput.files[0]);
  } else {
    await submitOrder(address, paymentMode, screenshot);
  }
};

async function submitOrder(address, paymentMode, screenshot) {
  const placeOrderBtn = document.getElementById("placeOrder");
  const placeOrderText = document.getElementById("placeOrderText");
  const loaderIcon = document.getElementById("loaderIcon");

  placeOrderBtn.disabled = true;
  placeOrderText.textContent = "Processing...";
  loaderIcon.classList.remove("hidden");

  const products = [{
    ...product,
    quantity: 1,
    subtotal: product.price
  }];
  const total = product.price + 30 + (product.price * 0.05);

  const order = {
    uid,
    address,
    products,
    total,
    paymentMode,
    paymentScreenshot: screenshot,
    paymentStatus: paymentMode === "cod" ? "pending" : "paid"
  };

  try {
    const res = await fetch("/api/submit-order", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(order)
    });

    const data = await res.json();

    if (res.ok) {
      
      window.location.href = "order.html";
    } else {
      alert("‚ùå Order Failed: " + data.error);
    }
  } catch (err) {
    alert("‚ùå Network error");
  }

  placeOrderBtn.disabled = false;
  placeOrderText.textContent = "Confirm Order";
  loaderIcon.classList.add("hidden");

}


</script>

</body>
</html>
